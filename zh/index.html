<!doctype html>
<html class="docs-version-current" lang="zh" dir="ltr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-beta.14">
<title data-react-helmet="true">简介 | 𝑪𝑲𝒊𝒃𝒂𝒏𝒂</title><meta data-react-helmet="true" name="twitter:card" content="summary_large_image"><meta data-react-helmet="true" property="og:url" content="http://CKibana.inf.17usoft.com/docs//ckibana-docs/zh/"><meta data-react-helmet="true" name="docusaurus_locale" content="zh"><meta data-react-helmet="true" name="docusaurus_version" content="current"><meta data-react-helmet="true" name="docusaurus_tag" content="docs-default-current"><meta data-react-helmet="true" property="og:title" content="简介 | 𝑪𝑲𝒊𝒃𝒂𝒏𝒂"><meta data-react-helmet="true" name="description" content="License"><meta data-react-helmet="true" property="og:description" content="License"><link data-react-helmet="true" rel="shortcut icon" href="/ckibana-docs/img/logo.svg"><link data-react-helmet="true" rel="canonical" href="http://CKibana.inf.17usoft.com/docs//ckibana-docs/zh/"><link data-react-helmet="true" rel="alternate" href="http://CKibana.inf.17usoft.com/docs//ckibana-docs/zh/" hreflang="en"><link data-react-helmet="true" rel="alternate" href="http://CKibana.inf.17usoft.com/docs//ckibana-docs/zh/zh/" hreflang="zh"><link data-react-helmet="true" rel="alternate" href="http://CKibana.inf.17usoft.com/docs//ckibana-docs/zh/" hreflang="x-default"><link rel="stylesheet" href="/ckibana-docs/assets/css/styles.c854e91c.css">
<link rel="preload" href="/ckibana-docs/assets/js/runtime~main.4ff13710.js" as="script">
<link rel="preload" href="/ckibana-docs/assets/js/main.15be6622.js" as="script">
</head>
<body>
<script>!function(){function e(e){document.documentElement.setAttribute("data-theme",e)}var t=function(){var e=null;try{e=localStorage.getItem("theme")}catch(e){}return e}();null!==t?e(t):window.matchMedia("(prefers-color-scheme: dark)").matches?e("dark"):(window.matchMedia("(prefers-color-scheme: light)").matches,e("light"))}()</script><div id="__docusaurus">
<div><a href="#" class="skipToContent_OuoZ">Skip to main content</a></div><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle clean-btn" type="button" tabindex="0"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" target="_self" href="/ckibana-docs/"><div class="navbar__logo"><img src="/ckibana-docs/img/ckibana-new.svg" alt="Site Logo" class="themedImage_TMUO themedImage--light_4Vu1" height="32" width="32"><img src="/ckibana-docs/img/ckibana-new.svg" alt="Site Logo" class="themedImage_TMUO themedImage--dark_uzRr" height="32" width="32"></div><b class="navbar__title">𝑪𝑲𝒊𝒃𝒂𝒏𝒂</b></a></div><div class="navbar__items navbar__items--right"><div class="navbar__search searchBarContainer_I7kZ"><input placeholder="Search" aria-label="Search" class="navbar__search-input"><div class="loadingRing_Zg7X searchBarLoadingRing_J5Ez"><div></div><div></div><div></div><div></div></div><div class="searchHintContainer_CDc6"><kbd class="searchHint_2RRg">ctrl</kbd><kbd class="searchHint_2RRg">K</kbd></div></div><div class="toggle_iYfV toggle_2i4l toggleDisabled_xj38"><div class="toggleTrack_t-f2" role="button" tabindex="-1"><div class="toggleTrackCheck_mk7D"><span class="toggleIcon_pHJ9">🌜</span></div><div class="toggleTrackX_dm8H"><span class="toggleIcon_pHJ9">🌞</span></div><div class="toggleTrackThumb_W6To"></div></div><input type="checkbox" class="toggleScreenReader_h9qa" aria-label="Switch between dark and light mode"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div class="main-wrapper docs-wrapper docs-doc-page"><div class="docPage_lDyR"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_i9tI" type="button"></button><aside class="docSidebarContainer_0YBq"><div class="sidebar_a3j0"><nav class="menu thin-scrollbar menu_cyFh"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/ckibana-docs/zh/UserCase">usercase</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/ckibana-docs/zh/api-docs">api-docs</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/ckibana-docs/zh/troubleshooting">troubleshooting</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" href="/ckibana-docs/zh/">简介</a></li></ul></nav></div></aside><main class="docMainContainer_r8cw"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div style="position:relative" class="col docItemCol_MGa7"><div style="width:100%"><article><div class="tocCollapsible_aw-L theme-doc-toc-mobile tocMobile_psec"><button type="button" class="clean-btn tocCollapsibleButton_zr6a">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>简介</h1></header><p><a href="https://opensource.org/licenses/Apache-2.0" target="_blank" rel="noopener noreferrer"><img src="https://img.shields.io/badge/License-Apache%202.0-blue.svg" alt="License"></a>
<a href="https://github.com/TongchengOpenSource/ckibana/releases" target="_blank" rel="noopener noreferrer"><img src="https://img.shields.io/github/release/TongchengOpenSource/ckibana.svg?color=brightgreen&amp;label=Release" alt="Release"></a></p><p><strong>ClickHouse adapter/proxy for Kibana</strong></p><p><strong>ClickHouse visualization tool</strong></p><p>CKibana是一个为了能够在原生kibana上直接使用ElasticSearch语法查询ClickHouse的服务。常见使用场景如:nginx日志从ElasticSearch迁移到ClickHouse后,不需要业务调整使用习惯就可以直接使用。</p><h2 class="anchor anchorWithStickyNavbar_y2LR" id="功能特性">功能特性<a aria-hidden="true" class="hash-link" href="#功能特性" title="Direct link to heading">​</a></h2><ul><li>版本支持: 兼容ElasticSearch跟kibana 6.x、7.x、8.x 版本</li><li>语法支持: 兼容ElasticSearch常用语法(注: ip_range跟date_range仅可在搜索框中使用querystring语法查询)</li><li>采样功能: 对于命中结果超过阈值的查询,支持动态计算采样+还原结果,提高查询性能且保障图表趋势基本跟真实数据趋势一致(限流阈值越大跟真实图表趋势越接近)。</li><li>缓存功能: 支持使用ElasticSearch来做结果缓存,来提升重复查询的性能</li><li>时间Round功能: 支持round查询时间,比如20s的round(例子: 查询时间秒在0-19s则自动round到0,20s-39s自动round到20s,比如查询时间是从01:50:15到05:52:47,则自动调整为从01:
50:00到05:52:40),配合缓存功能使用可以很好的缓解多个用户并发查询相同语句造成ClickHouse的压力</li><li>黑名单功能: 支持设置黑名单来防止复杂语句造成ClickHouse压力</li><li>查询模板功能: 支持按照去除时间后的语法监控,方便快速定位问题,配合黑名单功能一起使用可以很好的保障ClickHouse</li><li>查询熔断: 支持配置最大查询时间范围等高级功能</li></ul><h4 class="anchor anchorWithStickyNavbar_y2LR" id="支持的聚合语法">支持的聚合语法：<a aria-hidden="true" class="hash-link" href="#支持的聚合语法" title="Direct link to heading">​</a></h4><h2 class="anchor anchorWithStickyNavbar_y2LR" id="get-started">Get started<a aria-hidden="true" class="hash-link" href="#get-started" title="Direct link to heading">​</a></h2><h3 class="anchor anchorWithStickyNavbar_y2LR" id="quick-start">quick start<a aria-hidden="true" class="hash-link" href="#quick-start" title="Direct link to heading">​</a></h3><p>要快速体验ckibana，可以通过docker-compose进行快速部署</p><p><a href="https://github.com/TongchengOpenSource/ckibana/blob/main/docker-compose/README.md" target="_blank" rel="noopener noreferrer">ckibana-quick-start文档</a></p><div class="codeBlockContainer_J+bg language-shell"><div class="codeBlockContent_csEI shell"><pre tabindex="0" class="prism-code language-shell codeBlock_rtdJ thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#bfc7d5"><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic"># 进入docker-compose目录</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token builtin class-name" style="color:rgb(255, 203, 107)">cd</span><span class="token plain"> ckibana/docker-compose</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic"># 部署</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token function" style="color:rgb(130, 170, 255)">docker-compose</span><span class="token plain"> up -d</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>部署完成后，在浏览器访问kibana：<a href="http://127.0.0.1:5601/" target="_blank" rel="noopener noreferrer">http://127.0.0.1:5601/</a></p><p>已内置了mock数据的流程，导入kibana配置文件（大盘、index-pattern等），就可以开始体验了！</p><p>配置文件路径：docker-compose/quickstart-export.json
<img src="/ckibana-docs/assets/images/dashboard-import-57535ddd5204d4c2029f1e4499ee1e03.jpg">
效果展示：
<img src="/ckibana-docs/assets/images/dashboard-653023ff597452162127fb4b0c1328fe.jpg"></p><h3 class="anchor anchorWithStickyNavbar_y2LR" id="本地运行-ckibana">本地运行 ckibana<a aria-hidden="true" class="hash-link" href="#本地运行-ckibana" title="Direct link to heading">​</a></h3><p>ckibana可以在所有主要操作系统上运行，需要安装Java JDK版本17或更高版本。要检查，请运行
<code>java -version</code>:</p><div class="codeBlockContainer_J+bg language-shell"><div class="codeBlockContent_csEI shell"><pre tabindex="0" class="prism-code language-shell codeBlock_rtdJ thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#bfc7d5"><span class="token plain">$ java -version</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">java version </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;17.0.5&quot;</span><span class="token plain"> </span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>代理服务依赖<strong>ES、CK、Kibana</strong>服务，需要提前准备好。以下只包含从ck查询数据步骤，不包含写数据到ck的步骤。</p><p><strong>1）建库、建表</strong></p><p>在ck中初始化库、表结构，可以参考<a href="https://github.com/TongchengOpenSource/ckibana-docs/blob/main/api-docs.md" target="_blank" rel="noopener noreferrer">api-docs</a> 建表详解部分</p><p><strong>2）启动ckibana</strong></p><p>修改ckibana中的ES配置，需要改为自身的ES信息，配置文件路径为<code>src/main/resources/application.yml</code></p><div class="codeBlockContainer_J+bg language-yaml"><div class="codeBlockContent_csEI yaml"><pre tabindex="0" class="prism-code language-yaml codeBlock_rtdJ thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#bfc7d5"><span class="token key atrule">metadata-config</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token key atrule">hosts</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> your es metadata cluster hosts</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token key atrule">headers</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token key atrule">headerKey</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> yourHeaderValue</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>打包运行 或者 本地运行直接com.ly.ckibana.Bootstrap类即可</p><div class="codeBlockContainer_J+bg language-shell"><div class="codeBlockContent_csEI shell"><pre tabindex="0" class="prism-code language-shell codeBlock_rtdJ thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#bfc7d5"><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">### start ckibana</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">$ </span><span class="token function" style="color:rgb(130, 170, 255)">nohup</span><span class="token plain"> java -jar ckibana.jar </span><span class="token operator" style="color:rgb(137, 221, 255)">&gt;</span><span class="token plain"> run.out </span><span class="token operator file-descriptor important" style="color:rgb(137, 221, 255)">2</span><span class="token operator" style="color:rgb(137, 221, 255)">&gt;</span><span class="token file-descriptor important">&amp;1</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">&amp;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">### check whether ckibana is successfully started</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">$ </span><span class="token function" style="color:rgb(130, 170, 255)">tail</span><span class="token plain"> -f ~/logs/app.log</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">Tomcat started on port</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">s</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain">: </span><span class="token number" style="color:rgb(247, 140, 108)">8080</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">http</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> with context path </span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">Started Bootstrap </span><span class="token keyword" style="font-style:italic">in</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">1.474</span><span class="token plain"> seconds</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p><strong>3）启动kibana</strong></p><p>kibana的elasticsearchHosts参数配置为ckibana代理地址，这样就能走到代理服务中来</p><div class="codeBlockContainer_J+bg language-shell"><div class="codeBlockContent_csEI shell"><pre tabindex="0" class="prism-code language-shell codeBlock_rtdJ thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#bfc7d5"><span class="token plain">eg：elasticsearchHosts</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain">http://ip:port</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p><strong>4）配置index pattern白名单</strong></p><p>配置了对应的白名单，才可以在下一步创建index pattern</p><p><strong>5）在kibana中创建index pattern</strong></p><p>在kibana页面创建index pattern，名字跟1）的表名一致，且4）中配置白名单，然后就可以在kibana中进行查询了</p><div class="codeBlockContainer_J+bg language-shell"><div class="codeBlockContent_csEI shell"><pre tabindex="0" class="prism-code language-shell codeBlock_rtdJ thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#bfc7d5"><span class="token plain">eg：如果ck表名是table_test，则创建index pattern的名字就是table_test</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>以上5步都操作完以后，就可以创建大盘，开始进行使用了</p><h2 class="anchor anchorWithStickyNavbar_y2LR" id="todo">TODO<a aria-hidden="true" class="hash-link" href="#todo" title="Direct link to heading">​</a></h2><ul><li>分段查询: 支持自动拆分查询时间,可以充分利用缓存,提升查询性能</li></ul><h2 class="anchor anchorWithStickyNavbar_y2LR" id="文档地址">文档地址<a aria-hidden="true" class="hash-link" href="#文档地址" title="Direct link to heading">​</a></h2><p><a href="https://github.com/TongchengOpenSource/ckibana-docs" target="_blank" rel="noopener noreferrer">CKibane-docs</a></p><h2 class="anchor anchorWithStickyNavbar_y2LR" id="contact">Contact<a aria-hidden="true" class="hash-link" href="#contact" title="Direct link to heading">​</a></h2><p>愿意参与构建CKibana或者是需要交流问题可以加入微信群(企业版微信和个人版本微信均可)
<img src="http://oss.17usoft.com/infra-github/ckibana/join-us.png"></p><h2 class="anchor anchorWithStickyNavbar_y2LR" id="license">License<a aria-hidden="true" class="hash-link" href="#license" title="Direct link to heading">​</a></h2><p><a href="http://www.apache.org/licenses/LICENSE-2.0.html" target="_blank" rel="noopener noreferrer">Apache License, Version 2.0</a> Copyright (C) Apache Software Foundation</p></div></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages navigation"><div class="pagination-nav__item"><a class="pagination-nav__link" href="/ckibana-docs/zh/troubleshooting"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">« <!-- -->troubleshooting</div></a></div><div class="pagination-nav__item pagination-nav__item--next"></div></nav></div></div><div class="col col--3"><div class="toc-wrapper" style="padding-inline-end:1rem;padding-inline-start:1rem"><h2>Contents</h2><div class="tableOfContents_vrFS thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#功能特性" class="table-of-contents__link toc-highlight">功能特性</a></li><li><a href="#get-started" class="table-of-contents__link toc-highlight">Get started</a><ul><li><a href="#quick-start" class="table-of-contents__link toc-highlight">quick start</a></li><li><a href="#本地运行-ckibana" class="table-of-contents__link toc-highlight">本地运行 ckibana</a></li></ul></li><li><a href="#todo" class="table-of-contents__link toc-highlight">TODO</a></li><li><a href="#文档地址" class="table-of-contents__link toc-highlight">文档地址</a></li><li><a href="#contact" class="table-of-contents__link toc-highlight">Contact</a></li><li><a href="#license" class="table-of-contents__link toc-highlight">License</a></li></ul></div></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Community</div><ul class="footer__items"><li class="footer__item"><a href="https://github.com/TongchengOpenSource/ckibana/issues" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>Github Issues<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_wgqa"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li><li class="footer__item"><a href="https://tongchengopensource.github.io/ckibana-docs" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>CKibana Documentation<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_wgqa"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li></ul></div><div class="col footer__col"><div class="footer__title">Social</div><ul class="footer__items"><li class="footer__item"><a href="https://github.com/TongchengOpenSource/ckibana" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_wgqa"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2024 TongchengOpenSource</div></div></div></footer></div>
<script src="/ckibana-docs/assets/js/runtime~main.4ff13710.js"></script>
<script src="/ckibana-docs/assets/js/main.15be6622.js"></script>
</body>
</html>